<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD Smart Contract</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    
    <style>
        :root { 
            --primary: #D4AF37; 
            --dark: #2c3e50; 
            --light: #f8f9fa;
            --success: #25D366; /* Ù„ÙˆÙ† ÙˆØ§ØªØ³Ø§Ø¨ */
        }
        
        body { margin: 0; padding: 0; font-family: 'Assistant', sans-serif; background: var(--light); color: #333; }
        
        /* --- 1. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯ÙŠØ± --- */
        #adminView { 
            max-width: 600px; margin: 20px auto; background: white; padding: 20px; 
            border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
        }
        
        .header-logo { text-align: center; margin-bottom: 20px; }
        .header-logo img { max-width: 100px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: var(--dark); }
        .form-input { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 16px; box-sizing: border-box; background: #fafafa;
        }
        
        /* Ù…Ø­Ø±Ø± Ø§Ù„Ø¹Ù‚Ø¯ */
        .editor-box {
            width: 100%; height: 300px; padding: 10px; border: 1px solid #ccc; 
            border-radius: 8px; overflow-y: auto; background: white;
            font-size: 14px; line-height: 1.5; box-sizing: border-box;
        }
        .editor-box:focus { outline: 2px solid var(--primary); }

        .btn-action { 
            width: 100%; padding: 15px; border: none; border-radius: 8px; 
            font-size: 18px; font-weight: bold; cursor: pointer; display: flex; 
            align-items: center; justify-content: center; gap: 10px; margin-top: 10px;
        }
        .btn-whatsapp { background: var(--success); color: white; }
        .btn-copy { background: var(--dark); color: var(--primary); }

        /* --- 2. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆØ¸Ù (Wizard) --- */
        #employeeView { display: none; height: 100vh; flex-direction: column; }
        .step-header { background: var(--dark); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .step-content { flex: 1; padding: 20px; overflow-y: auto; text-align: center; }
        .step-content.active { display: block; }
        .step-content { display: none; }
        
        .info-box { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: right; margin-bottom: 20px; }
        
        .big-btn { 
            width: 100%; padding: 15px; margin-bottom: 10px; border: 2px dashed #ccc; 
            border-radius: 10px; background: white; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .big-btn.done { border-color: var(--success); background: #eaffea; color: var(--success); }

        .nav-bar { padding: 15px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .nav-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-next { background: var(--dark); color: white; }
        .btn-prev { background: #eee; color: #333; }

        /* Signature Modal */
        #sigModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 999; display: none; flex-direction: column; }
        canvas { flex: 1; border: 1px solid #eee; background: #fff; }

        /* Print Preview */
        #previewContainer { display: none; background: #555; padding: 10px; }
        .a4-page { background: white; width: 210mm; min-height: 297mm; margin: 0 auto; padding: 20mm; position: relative; }
        @media screen and (max-width: 800px) { .a4-page { width: 100%; height: auto; padding: 15mm; } }
        @media print {
            #adminView, #employeeView, .nav-bar { display: none !important; }
            #previewContainer { display: block !important; padding: 0; }
            .a4-page { width: 100%; box-shadow: none; margin: 0; page-break-after: always; }
        }
    </style>
</head>
<body>

    <div id="adminView">
        <div class="header-logo"><img src="logo.jpg" alt="Logo"></div>
        <h2 style="text-align:center; margin:0 0 20px 0;">×”×›× ×ª ×—×•×–×” ×œ×¢×•×‘×“ (Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ù‚Ø¯)</h2>

        <div class="form-group">
            <label>1. ×©× ×”×¢×•×‘×“ (Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù):</label>
            <input type="text" id="admName" class="form-input" placeholder="×™×©×¨××œ ×™×©×¨××œ×™">
        </div>

        <div class="form-group">
            <label>2. ×ª×¢×•×“×ª ×–×”×•×ª (Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©):</label>
            <input type="tel" id="admID" class="form-input" placeholder="123456789">
        </div>

        <div class="form-group">
            <label style="color:var(--success); font-size:18px;">3. ×©×›×¨ ×œ×©×¢×” (Ø§Ù„Ø£Ø¬Ø± Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©):</label>
            <input type="number" id="admSalary" class="form-input" value="35" style="border:2px solid var(--success); font-weight:bold;">
        </div>

        <div class="form-group">
            <label>4. ×¢×¨×•×š ××ª ×”×”×¡×›× (Ø¹Ø¯Ù„ Ø§Ù„Ø§ØªÙØ§Ù‚ Ù‡Ù†Ø§):</label>
            <div id="contractEditor" class="editor-box" contenteditable="true">
                <h3 style="text-align:center; text-decoration:underline;">×”×¡×›× ×¢×‘×•×“×” ××™×©×™</h3>
                <p><strong>×‘×™×Ÿ: ×—×‘×¨×ª ×××“ ×¤×¨×¤×™×•× ×‘×¢"×</strong> (×”××¢×¡×™×§) <br> <strong>×œ×‘×™×Ÿ: {{NAME}}</strong>, ×ª.×– {{ID}} (×”×¢×•×‘×“)</p>
                
                <h4>1. ×ª×¤×§×™×“ ×•×©×›×¨</h4>
                <ul>
                    <li>×”×¢×•×‘×“ ×™×•×¢×¡×§ ×‘×ª×¤×§×™×“ <strong>××•×›×¨ / ×™×•×¢×¥ ××›×™×¨×•×ª</strong>.</li>
                    <li>×©×›×¨ ×”×‘×¡×™×¡: <strong>{{SALARY}} â‚ª ×œ×©×¢×”</strong>.</li>
                    <li>×”×™×§×£ ×”××©×¨×”: ××©××¨×•×ª.</li>
                </ul>

                <h4>2. ×ª×§×•×¤×ª ×”×¢×¡×§×”</h4>
                <ul>
                    <li>×ª×§×•×¤×ª × ×™×¡×™×•×Ÿ: 3-6 ×—×•×“×©×™× ×”×¨××©×•× ×™×.</li>
                    <li>×”×•×“×¢×” ××•×§×“××ª ×œ×¡×™×•× ×¢×‘×•×“×” ×ª×™× ×ª×Ÿ ×‘×›×ª×‘ ×¢"×¤ ×—×•×§.</li>
                </ul>

                <h4>3. ×ª× ××™× ×¡×•×¦×™××œ×™×™×</h4>
                <ul>
                    <li>× ×¡×™×¢×•×ª ×•×”×‘×¨××” ×™×©×•×œ××• ×›×—×•×§.</li>
                    <li>×”×¤×¨×©×•×ª ×œ×¤× ×¡×™×” ×™×‘×•×¦×¢×• ×œ××—×¨ 6 ×—×•×“×©×™× (××• ×¢"×¤ ×¨×¦×£ ×‘×™×˜×•×—×™).</li>
                </ul>

                <h4>4. ×¡×•×“×™×•×ª ×•××©××¢×ª</h4>
                <ul>
                    <li>×”×¢×•×‘×“ ××ª×—×™×™×‘ ×œ×©××•×¨ ×¢×œ ×¡×•×“×™×•×ª ××•×—×œ×˜×ª ×©×œ × ×ª×•× ×™ ×”×—×‘×¨×”.</li>
                    <li>×”××¢×¡×™×§ ×¨×©××™ ×œ×¡×™×™× ×”×¢×¡×§×” ×œ××œ×ª×¨ ×‘××§×¨×” ×©×œ ×’× ×™×‘×” ××• ××œ×™××•×ª.</li>
                </ul>
                <p style="margin-top:20px;">×•×œ×¨××™×” ×‘××• ×”×¦×“×“×™× ×¢×œ ×”×—×ª×•×:</p>
            </div>
        </div>

        <button class="btn-action btn-whatsapp" onclick="sendWhatsApp()">
            <i class="fab fa-whatsapp"></i> ×©×œ×— ×‘×•×•××˜×¡××¤ (Ø£Ø±Ø³Ù„ ÙˆØ§ØªØ³Ø§Ø¨)
        </button>
        
        <button class="btn-action btn-copy" onclick="copyLink()">
            <i class="fas fa-link"></i> ×”×¢×ª×§ ×§×™×©×•×¨ (Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·)
        </button>
    </div>

    <div id="employeeView">
        <div class="step-header">MAD PARFUMEUR - ×—×ª×™××” ×¢×œ ×—×•×–×”</div>

        <div id="step1" class="step-content active">
            <h3>×©×œ×•×, <span id="dispName"></span></h3>
            <p>×× × ×‘×“×•×§ ××ª ×”×¤×¨×˜×™× ×œ×¤× ×™ ×”×—×ª×™××”:</p>
            <div class="info-box">
                <p><strong>×ª.×–:</strong> <span id="dispID"></span></p>
                <p><strong>×©×›×¨ ×œ×©×¢×”:</strong> <span id="dispSalary" style="color:green; font-weight:bold;"></span> â‚ª</p>
            </div>
        </div>

        <div id="step2" class="step-content">
            <h3>×—×ª×™××” ×“×™×’×™×˜×œ×™×ª</h3>
            <p>×œ×—×¥ ×œ××˜×” ×›×“×™ ×œ×—×ª×•× ×¢×œ ×”××¡×š</p>
            <button class="big-btn" id="btnSign" onclick="openSigPad()">ğŸ–‹ ×œ×—×¥ ×›××Ÿ ×œ×—×ª×™××”</button>
            <img id="previewSig" style="max-width:100%; display:none; margin:10px auto;">
        </div>

        <div id="step3" class="step-content">
            <h3>×¦×™×œ×•× ××¡××›×™×</h3>
            <label class="big-btn" id="btnFront">
                ğŸ“· ×¦×œ× ×ª×¢×•×“×ª ×–×”×•×ª
                <input type="file" hidden accept="image/*" onchange="handleImg(this, 'imgFront', 'btnFront')">
            </label>
            <label class="big-btn" id="btnBack">
                ğŸ“„ ×¦×œ× ×¡×¤×—
                <input type="file" hidden accept="image/*" onchange="handleImg(this, 'imgBack', 'btnBack')">
            </label>
        </div>

        <div class="nav-bar">
            <button class="nav-btn btn-prev" onclick="prevStep()" id="btnPrev" style="visibility:hidden;">×—×–×•×¨</button>
            <button class="nav-btn btn-next" onclick="nextStep()" id="btnNext">×”×‘×</button>
        </div>
    </div>

    <div id="sigModal">
        <div style="padding:10px; text-align:center; background:#eee;">×—×ª×•× ×›××Ÿ (Sign Here)</div>
        <canvas id="theCanvas"></canvas>
        <div style="display:flex; padding:10px; gap:10px;">
            <button onclick="clearPad()" class="nav-btn" style="background:#e74c3c; color:white;">× ×§×”</button>
            <button onclick="savePad()" class="nav-btn" style="background:var(--success); color:white;">××©×¨</button>
        </div>
    </div>

    <div id="previewContainer">
        <div class="a4-page">
            <div style="text-align:center;"><img src="logo.jpg" style="width:150px;"></div>
            <div id="finalContractBody" style="font-size:14px; line-height:1.6;"></div>
            
            <div style="margin-top:50px; display:flex; justify-content:space-between;">
                <div style="text-align:center;"><img src="signther.jpg" width="100"><br><strong>×”××¢×¡×™×§</strong></div>
                <div style="text-align:center;"><img id="finalSig" height="60"><br><strong>×—×ª×™××ª ×”×¢×•×‘×“</strong></div>
            </div>
        </div>
        <div class="a4-page" style="text-align:center;">
            <h3>× ×¡×¤×—: ×ª×¢×•×“×ª ×–×”×•×ª</h3>
            <img id="finalImgFront" style="max-width:90%; margin-bottom:20px;"><br>
            <img id="finalImgBack" style="max-width:90%;">
        </div>
        <div style="position:fixed; bottom:0; left:0; width:100%; background:white; padding:10px; display:flex; gap:10px; box-shadow:0 -2px 10px rgba(0,0,0,0.2);">
            <button class="nav-btn" style="background:var(--dark); color:white;" onclick="window.print()">ğŸ’¾ ×©××•×¨ PDF</button>
            <button class="nav-btn" style="background:var(--success); color:white;" onclick="notifyBoss()">âœ… ×©×œ×— ×œ×× ×”×œ</button>
        </div>
    </div>

    <script>
        // --- ADMIN LOGIC ---
        function getLinkData() {
            const name = document.getElementById('admName').value;
            const id = document.getElementById('admID').value;
            const salary = document.getElementById('admSalary').value;
            const body = document.getElementById('contractEditor').innerHTML; // Get edited HTML

            if(!name || !id) return null;

            const data = { n: name, i: id, s: salary, b: body };
            // Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚ØµÙŠØ±Ø§Ù‹
            return LZString.compressToEncodedURIComponent(JSON.stringify(data));
        }

        function sendWhatsApp() {
            const compressed = getLinkData();
            if(!compressed) { alert('× × ×œ××œ× ×©× ×•×ª×¢×•×“×ª ×–×”×•×ª'); return; }
            
            const link = window.location.href.split('?')[0] + '?d=' + compressed;
            const text = `×”×™×™ ${document.getElementById('admName').value}, ×œ×—×¥ ×¢×œ ×”×§×™×©×•×¨ ×›×“×™ ×œ×—×ª×•× ×¢×œ ×”×¡×›× ×”×¢×‘×•×“×”:\n${link}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        function copyLink() {
            const compressed = getLinkData();
            if(!compressed) { alert('× × ×œ××œ× ×©× ×•×ª×¢×•×“×ª ×–×”×•×ª'); return; }
            const link = window.location.href.split('?')[0] + '?d=' + compressed;
            navigator.clipboard.writeText(link).then(() => alert('×”×§×™×©×•×¨ ×”×•×¢×ª×§!'));
        }

        // --- EMPLOYEE LOGIC ---
        let currentStep = 1;
        let empData = {};
        let sigData = null, img1 = null, img2 = null;

        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            if(params.has('d')) {
                // Employee Mode
                document.getElementById('adminView').style.display = 'none';
                document.getElementById('employeeView').style.display = 'flex';
                
                try {
                    // ÙÙƒ Ø§Ù„Ø¶ØºØ·
                    const json = LZString.decompressFromEncodedURIComponent(params.get('d'));
                    empData = JSON.parse(json);
                    
                    // Fill Data
                    document.getElementById('dispName').innerText = empData.n;
                    document.getElementById('dispID').innerText = empData.i;
                    document.getElementById('dispSalary').innerText = empData.s;

                    // Prepare Final Body
                    let content = empData.b;
                    content = content.replace(/{{NAME}}/g, empData.n).replace(/{{ID}}/g, empData.i).replace(/{{SALARY}}/g, empData.s);
                    document.getElementById('finalContractBody').innerHTML = content;

                } catch(e) { alert('×§×™×©×•×¨ ×œ× ×ª×§×™×Ÿ'); }
            }
        };

        function nextStep() {
            if(currentStep === 2 && !sigData) return alert('×—×•×‘×” ×œ×—×ª×•×');
            if(currentStep === 3) {
                if(!img1) return alert('×—×•×‘×” ×œ×¦×¨×£ ×ª×¢×•×“×”');
                document.getElementById('employeeView').style.display = 'none';
                document.getElementById('previewContainer').style.display = 'block';
                return;
            }
            currentStep++;
            updateStep();
        }

        function prevStep() { currentStep--; updateStep(); }

        function updateStep() {
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            document.getElementById('step'+currentStep).classList.add('active');
            document.getElementById('btnPrev').style.visibility = currentStep > 1 ? 'visible' : 'hidden';
            if(currentStep === 3) document.getElementById('btnNext').innerText = '×¡×™×•× ×•×”×¦×’×”';
            else document.getElementById('btnNext').innerText = '×”×‘×';
        }

        // --- SIGNATURE ---
        const modal = document.getElementById('sigModal');
        const canvas = document.getElementById('theCanvas');
        const ctx = canvas.getContext('2d');
        let painting = false;

        function openSigPad() { 
            modal.style.display = 'flex'; 
            canvas.width = window.innerWidth; canvas.height = window.innerHeight - 100; 
        }
        function clearPad() { ctx.clearRect(0,0,canvas.width,canvas.height); }
        function savePad() {
            sigData = canvas.toDataURL();
            document.getElementById('previewSig').src = sigData;
            document.getElementById('previewSig').style.display = 'block';
            document.getElementById('finalSig').src = sigData;
            document.getElementById('btnSign').classList.add('done');
            document.getElementById('btnSign').innerText = '× ×—×ª× âœ“';
            modal.style.display = 'none';
        }

        function start(e) { painting = true; draw(e); }
        function end() { painting = false; ctx.beginPath(); }
        function draw(e) {
            if(!painting) return; e.preventDefault();
            const x = (e.clientX||e.touches[0].clientX); const y = (e.clientY||e.touches[0].clientY) - 50;
            ctx.lineWidth = 3; ctx.lineCap = 'round'; ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
        }
        canvas.addEventListener('touchstart', start, {passive:false}); canvas.addEventListener('touchend', end); canvas.addEventListener('touchmove', draw, {passive:false});
        canvas.addEventListener('mousedown', start); canvas.addEventListener('mouseup', end); canvas.addEventListener('mousemove', draw);

        // --- IMAGES ---
        function handleImg(input, type, btnID) {
            if(input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if(type==='imgFront') img1 = e.target.result; else img2 = e.target.result;
                    document.getElementById('final'+type.charAt(0).toUpperCase()+type.slice(1)).src = e.target.result;
                    document.getElementById(btnID).classList.add('done');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function notifyBoss() {
            const msg = `×”×™×™, ×—×ª××ª×™ ×¢×œ ×”×”×¡×›×. ×× ×™ ×©×•×œ×— ×œ×š ××ª ×”-PDF ×¢×›×©×™×•.`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
