<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD Corporate Contract</title>
    <link href="https://fonts.googleapis.com/css2?family=David+Libre:wght@400;700&family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root { --primary: #D4AF37; --dark: #1a1a1a; --light: #f4f4f4; --green: #27ae60; }
        
        /* Reset & Basics */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: 'Assistant', sans-serif; background: var(--light); color: #333; padding-bottom: 80px; }
        
        /* Header */
        .app-header { background: #fff; padding: 15px; text-align: center; border-bottom: 4px solid var(--primary); }
        .logo { max-width: 120px; }
        
        /* Cards */
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 3px solid var(--dark); }
        .card-title { font-weight: bold; font-size: 18px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; color: var(--dark); }

        /* Inputs */
        .input-group { margin-bottom: 15px; }
        .label { display: block; font-size: 14px; margin-bottom: 5px; font-weight: bold; }
        .input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; background: #fafafa; }
        
        /* Contract Box */
        .contract-box { 
            height: 300px; overflow-y: auto; background: #fff; border: 1px solid #ccc; padding: 20px; 
            font-family: 'David Libre', serif; font-size: 15px; line-height: 1.6; text-align: justify;
        }
        .contract-box h2, .contract-box h3 { text-align: center; margin-bottom: 15px; }
        .fill-data { font-weight: bold; border-bottom: 1px dotted #000; }

        /* Buttons */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-sig { background: white; border: 2px solid #333; color: #333; }
        .btn-sig.done { background: #333; color: #fff; border-color: #333; }
        .btn-upload { background: #f0f0f0; color: #333; border: 1px solid #ccc; margin-bottom: 10px; }
        .btn-upload.done { background: var(--green); color: white; }
        .btn-save { background: var(--primary); color: #000; margin-top: 20px; }

        /* --- FIXED SIGNATURE MODAL --- */
        #sigModal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 9999; 
            display: none; flex-direction: column; justify-content: center; padding: 10px;
        }
        .modal-content { 
            background: white; border-radius: 10px; display: flex; flex-direction: column; 
            height: 70vh; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª ÙˆÙ…Ø±ÙŠØ­ */
            width: 100%; max-width: 500px; margin: 0 auto;
            overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .modal-header { padding: 15px; background: #eee; text-align: center; font-weight: bold; border-bottom: 1px solid #ddd; }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ù… */
        .canvas-container { flex: 1; position: relative; background: #fff; width: 100%; overflow: hidden; }
        canvas { 
            display: block; width: 100%; height: 100%; 
            touch-action: none; /* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù…Ù†Ø¹ ØªØ­Ø±Ùƒ Ø§Ù„Ø´Ø§Ø´Ø© */
            cursor: crosshair;
        }
        
        .modal-footer { padding: 15px; display: flex; gap: 10px; background: #eee; border-top: 1px solid #ddd; }

        /* Print */
        #printArea { display: none; }
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; display: block !important; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; }
            .legal-page { width: 100%; page-break-after: always; padding: 20mm; text-align: justify; }
        }
    </style>
</head>
<body>

    <div class="app-header">
        <img src="logo.jpg" class="logo" onerror="this.style.display='none'">
        <div>××¢×¨×›×ª ××©××‘×™ ×× ×•×©</div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-title">1. ×¤×¨×˜×™ ×¢×•×‘×“</div>
            <div class="input-group"><span class="label">×©× ××œ×:</span><input type="text" id="inpName" class="input" placeholder="×™×©×¨××œ ×™×©×¨××œ×™" oninput="updateContract()"></div>
            <div class="input-group"><span class="label">×ª.×–:</span><input type="tel" id="inpID" class="input" placeholder="000000000" oninput="updateContract()"></div>
            <div class="input-group"><span class="label">×©×›×¨ ×œ×©×¢×”:</span><input type="number" id="inpSalary" class="input" value="35" oninput="updateContract()"></div>
        </div>

        <div class="card">
            <div class="card-title">2. ×”×¡×›× ×”×¢×¡×§×”</div>
            <div class="contract-box">
                <h2>×”×¡×›× ×”×¢×¡×§×” ××™×©×™</h2>
                <p>× ×¢×¨×š ×‘×™×•×: <strong><span id="dateDisplay"></span></strong></p>
                <p><strong>×‘×™×Ÿ: ×××“ ×¤×¨×¤×™×•× ×‘×¢"×</strong> (×”××¢×¡×™×§)<br><strong>×œ×‘×™×Ÿ: <span class="fill-data" id="outName">_______</span></strong> (×”×¢×•×‘×“)</p>
                <h3>×ª× ××™× ×•×¢×™×§×¨×™ ×”×”×¡×›×</h3>
                <ul>
                    <li>×”×¢×•×‘×“ ×™×•×¢×¡×§ ×‘×ª×¤×§×™×“ ××•×›×¨ / ×™×•×¢×¥ ××›×™×¨×•×ª.</li>
                    <li>×”×©×›×¨: <strong><span class="fill-data" id="outSalary">35</span> â‚ª</strong> ×œ×©×¢×”.</li>
                    <li>×ª× ××™× ×¡×•×¦×™××œ×™×™× (×¤× ×¡×™×”, ×”×‘×¨××”, × ×¡×™×¢×•×ª) ×›×—×•×§.</li>
                    <li>×”×¢×•×‘×“ ××ª×—×™×™×‘ ×œ×¡×•×“×™×•×ª ××•×—×œ×˜×ª.</li>
                </ul>
                <p><strong>×•×œ×¨××™×” ×‘××• ×”×¦×“×“×™× ×¢×œ ×”×—×ª×•×:</strong></p>
            </div>
        </div>

        <div class="card">
            <div class="card-title">3. ×—×ª×™××” ×•×¦×¨×•×¤×•×ª (×—×•×‘×”)</div>
            
            <button class="btn btn-sig" id="btnSignModal" onclick="openSigPad()">
                <i class="fas fa-pen-nib"></i> ×œ×—×¥ ×›××Ÿ ×œ×—×ª×™××”
            </button>
            
            <div id="sigPreviewBox" style="display:none; text-align:center; margin-top:15px; padding:10px; border:1px solid #27ae60; background:#f0fff4; border-radius:6px;">
                <p style="margin:0 0 5px 0; color:#27ae60; font-size:12px;">×”×—×ª×™××” × ×§×œ×˜×”:</p>
                <img id="sigPreviewImg" style="max-height:60px;">
            </div>

            <div style="margin-top:20px; padding-top:15px; border-top:1px dashed #ccc;">
                <label class="btn btn-upload" id="btnFront">ğŸ“· ×¦×™×œ×•× ×ª×¢×•×“×”<input type="file" hidden accept="image/*" onchange="handleImg(this,'front')"></label>
                <label class="btn btn-upload" id="btnBack">ğŸ“„ ×¦×™×œ×•× ×¡×¤×—<input type="file" hidden accept="image/*" onchange="handleImg(this,'back')"></label>
            </div>
        </div>

        <button class="btn btn-save" onclick="finishProcess()">ğŸ’¾ ×©××™×¨×” ×•×¡×™×•× (PDF)</button>
    </div>

    <div id="sigModal">
        <div class="modal-content">
            <div class="modal-header">×—×ª×•× ×‘×ª×•×š ×”××¡×’×¨×ª</div>
            
            <div class="canvas-container" id="canvasContainer">
                <canvas id="sigCanvas"></canvas>
            </div>
            
            <div class="modal-footer">
                <button class="btn" style="background:#e74c3c; color:white; flex:1;" onclick="clearPad()">× ×§×”</button>
                <button class="btn" style="background:var(--green); color:white; flex:1;" onclick="savePad()" ontouchstart="savePad()">××™×©×•×¨</button>
            </div>
        </div>
    </div>

    <div id="printArea">
        <div class="legal-page">
            <div style="text-align:center;"><img src="logo.jpg" width="150"></div>
            <div id="printContractContent" style="margin-top:20px; font-size:14px; line-height:1.5;"></div>
            <div style="margin-top:50px; display:flex; justify-content:space-between; align-items:flex-end;">
                <div style="text-align:center; width:45%;"><img src="signther.jpg" width="120"><br><strong>×”×—×‘×¨×”</strong></div>
                <div style="text-align:center; width:45%;"><img id="printSigImg" height="80"><br><strong>×”×¢×•×‘×“</strong></div>
            </div>
        </div>
        <div class="legal-page" style="text-align:center;">
            <h3>× ×¡×¤×—: ×ª×¢×•×“×ª ×–×”×•×ª</h3>
            <img id="printImgFront" style="max-width:90%; margin-bottom:20px;"><br>
            <img id="printImgBack" style="max-width:90%;">
        </div>
    </div>

    <script>
        // --- 1. Init ---
        document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('he-IL');

        function updateContract() {
            document.getElementById('outName').innerText = document.getElementById('inpName').value || "_______";
            document.getElementById('outSalary').innerText = document.getElementById('inpSalary').value || "35";
        }

        // --- 2. Signature Logic (Improved) ---
        const modal = document.getElementById('sigModal');
        const canvas = document.getElementById('sigCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvasContainer');
        
        let isDrawing = false;
        let sigData = null;

        function openSigPad() {
            modal.style.display = 'flex';
            // Ù…Ù‡Ù„Ø© Ù‚ØµÙŠØ±Ø© Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Ø§ÙØ°Ø© Ù‚Ø¨Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
            setTimeout(() => {
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000';
            }, 100);
        }

        function clearPad() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            sigData = null;
        }

        function savePad(e) {
            if(e) e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³
            
            // Ù‡Ù„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ ÙØ§Ø±ØºØŸ (ÙØ­Øµ Ø¨Ø³ÙŠØ·)
            // Ø³Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ‚Ø¹ØŒ Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ù„ÙØ­Øµ Ø§Ù„Ø¨ÙŠÙƒØ³Ù„Ø§Øª
            
            sigData = canvas.toDataURL();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            document.getElementById('sigPreviewImg').src = sigData;
            document.getElementById('sigPreviewBox').style.display = 'block';
            document.getElementById('printSigImg').src = sigData;
            
            // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            const mainBtn = document.getElementById('btnSignModal');
            mainBtn.classList.add('done');
            mainBtn.innerHTML = '<i class="fas fa-check"></i> ×”×—×ª×™××” × ×©××¨×” ×‘×”×¦×œ×—×”';
            
            modal.style.display = 'none';
        }

        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø±Ø³Ù… (Mouse + Touch)
        function startDraw(e) {
            isDrawing = true;
            draw(e);
        }
        function endDraw() {
            isDrawing = false;
            ctx.beginPath();
        }
        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault(); // Ù…Ù†Ø¹ ØªØ­Ø±Ùƒ Ø§Ù„ØµÙØ­Ø©

            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;

            if (e.touches) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const x = clientX - rect.left;
            const y = clientY - rect.top;

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('touchstart', startDraw, {passive: false});

        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('touchend', endDraw);

        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchmove', draw, {passive: false});

        // --- 3. Images ---
        let imgReady = false;
        function handleImg(input, type) {
            if (input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if(type==='front') {
                        document.getElementById('printImgFront').src = e.target.result;
                        document.getElementById('btnFront').classList.add('done');
                        document.getElementById('btnFront').innerHTML = 'ğŸ“· ×ª×¢×•×“×” ×¦×•×¨×¤×”';
                        imgReady = true;
                    } else {
                        document.getElementById('printImgBack').src = e.target.result;
                        document.getElementById('btnBack').classList.add('done');
                        document.getElementById('btnBack').innerHTML = 'ğŸ“„ ×¡×¤×— ×¦×•×¨×£';
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- 4. Finish ---
        function finishProcess() {
            if(!document.getElementById('inpName').value) return alert('× × ×œ××œ× ×©× ××œ×');
            if(!sigData) return alert('×—×•×‘×” ×œ×—×ª×•×');
            if(!imgReady) return alert('×—×•×‘×” ×œ×¦×¨×£ ×ª×¢×•×“×”');

            document.getElementById('printContractContent').innerHTML = document.querySelector('.contract-box').innerHTML;
            window.print();
        }
    </script>
</body>
</html>
