<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD PARFUMEUR | Enterprise Admin System</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --royal-black: #0a0a0a;
            --deep-gold: #b38b2d;
            --soft-gold: #d4af37;
            --bg-canvas: #1e1e1e;
        }

        body { margin: 0; font-family: 'Assistant', sans-serif; background: var(--bg-canvas); color: #333; }

        /* --- Toolbar --- */
        .toolbar {
            position: sticky; top: 0; width: 100%; background: #111; padding: 12px;
            display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;
            z-index: 2000; border-bottom: 2px solid var(--deep-gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .toolbar button, .toolbar select {
            background: #222; color: #fff; border: 1px solid var(--deep-gold);
            padding: 8px 15px; cursor: pointer; border-radius: 4px; font-weight: bold;
            transition: 0.3s;
        }
        .toolbar button:hover { background: var(--deep-gold); color: black; }
        .btn-print { background: var(--deep-gold) !important; color: black !important; }
        .btn-reset { background: #600 !important; border-color: #f00 !important; }

        /* --- Paper Style --- */
        .page-container { display: flex; justify-content: center; padding: 40px 0; }
        .paper {
            width: 210mm; min-height: 297mm; background: white; position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); display: flex; flex-direction: column;
        }

        /* --- Graphic Frames --- */
        .top-frame { height: 160px; background: var(--royal-black); clip-path: polygon(0 0, 100% 0, 100% 60%, 0% 100%); position: relative; }
        .top-frame::after { content: ""; position: absolute; bottom: 0; right: 0; width: 100%; height: 12px; background: var(--deep-gold); transform: translateY(5px) rotate(-2deg); }
        
        .bottom-frame { height: 100px; background: var(--royal-black); clip-path: polygon(0 40%, 100% 0, 100% 100%, 0% 100%); margin-top: auto; position: relative; }
        .bottom-frame::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 8px; background: var(--deep-gold); transform: translateY(-4px) rotate(1deg); }

        /* --- Moveable Elements --- */
        .movable { position: absolute; cursor: move; z-index: 100; border: 1px dashed transparent; }
        .movable:hover { border: 1px dashed var(--deep-gold); }
        .movable img { width: 100%; height: auto; display: block; pointer-events: none; }
        .resizer { width: 12px; height: 12px; background: var(--deep-gold); position: absolute; right: -5px; bottom: -5px; cursor: nwse-resize; border-radius: 50%; display: none; }
        .movable:hover .resizer { display: block; }
        .locked { border: none !important; cursor: default !important; }
        .locked .resizer { display: none !important; }

        /* --- Content Areas --- */
        .main-content { padding: 40px 60px; flex-grow: 1; outline: none; font-family: 'Amiri', serif; font-size: 13pt; line-height: 1.6; }
        .doc-title { text-align: center; font-size: 28pt; font-weight: bold; color: var(--royal-black); margin-bottom: 20px; text-decoration: underline; }

        /* --- Table Styling --- */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th { background: var(--royal-black); color: white; padding: 12px; border: 1px solid #333; }
        td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .add-row-btn { background: #eee; border: 1px dashed #ccc; width: 100%; padding: 8px; cursor: pointer; margin-top: 5px; font-weight: bold; }

        /* --- Print Mode --- */
        @media print {
            body { background: white; } .toolbar, .add-row-btn { display: none !important; }
            .page-container { padding: 0; } .paper { box-shadow: none; width: 100%; margin: 0; }
            .movable { border: none !important; } .resizer { display: none !important; }
        }
    </style>
</head>
<body>

<div class="toolbar">
    <select id="templateSelector" onchange="loadTemplate()">
        <option value="contract">ğŸ“„ Ø¹Ù‚Ø¯ Ø¹Ù…Ù„ Ù…ÙˆØ¸Ù</option>
        <option value="invoice">ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ© (Invoice)</option>
        <option value="delivery">ğŸšš Ø¥Ø±Ø³Ø§Ù„ÙŠØ© (Delivery)</option>
        <option value="blank">âšª ØµÙØ­Ø© ÙØ§Ø±ØºØ©</option>
    </select>
    
    <button onclick="toggleDir()">ğŸ”„ ØªØ­ÙˆÙŠÙ„ (AR/HE)</button>
    <button onclick="insertDate()">ğŸ“… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„ØªØ§Ø±ÙŠØ®</button>
    <button onclick="toggleLock()" id="lockBtn">ğŸ”“ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ØªØ­Ø±ÙƒØ©</button>
    <button onclick="document.execCommand('bold')">B</button>
    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ØªØµØ¯ÙŠØ± PDF</button>
    <button class="btn-reset" onclick="resetAll()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</div>

<div class="page-container">
    <div class="paper" id="paper" dir="rtl">
        <div class="top-frame"></div>

        <div class="movable" id="logoContainer" style="top: 30px; left: 50px; width: 180px;">
            <img src="logo.jpg" alt="Logo">
            <div class="resizer"></div>
        </div>

        <div class="main-content" contenteditable="true" id="editorArea">
            </div>

        <div class="movable" id="signContainer" style="bottom: 120px; left: 50px; width: 150px;">
            <img src="signther.jpg" alt="Signature">
            <div class="resizer"></div>
        </div>

        <div class="bottom-frame"></div>
    </div>
</div>

<script>
    let isLocked = false;
    const editor = document.getElementById('editorArea');

    // --- Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
    function saveAll() {
        localStorage.setItem('mad_content', editor.innerHTML);
        localStorage.setItem('logo_pos', JSON.stringify({
            top: logoContainer.style.top,
            left: logoContainer.style.left,
            width: logoContainer.style.width
        }));
    }

    function loadSaved() {
        const savedText = localStorage.getItem('mad_content');
        if (savedText) editor.innerHTML = savedText;
        else loadTemplate();

        const logoPos = JSON.parse(localStorage.getItem('logo_pos'));
        if (logoPos) {
            logoContainer.style.top = logoPos.top;
            logoContainer.style.left = logoPos.left;
            logoContainer.style.width = logoPos.width;
        }
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØ± ---
    function makeMovable(el) {
        let isDragging = false, isResizing = false, sx, sy, sw, sh;
        el.onmousedown = (e) => {
            if (isLocked) return;
            if (e.target.className === 'resizer') isResizing = true;
            else isDragging = true;
            sx = e.clientX; sy = e.clientY;
            sw = el.offsetWidth; sh = el.offsetHeight;
            e.preventDefault();
        };
        document.onmousemove = (e) => {
            if (isDragging) {
                el.style.left = (el.offsetLeft + (e.clientX - sx)) + "px";
                el.style.top = (el.offsetTop + (e.clientY - sy)) + "px";
                sx = e.clientX; sy = e.clientY;
            } else if (isResizing) {
                el.style.width = (sw + (e.clientX - sx)) + "px";
            }
            saveAll();
        };
        document.onmouseup = () => { isDragging = false; isResizing = false; };
    }

    makeMovable(document.getElementById('logoContainer'));
    makeMovable(document.getElementById('signContainer'));

    function toggleLock() {
        isLocked = !isLocked;
        const btn = document.getElementById('lockBtn');
        btn.innerText = isLocked ? "ğŸ”’ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù‚ÙÙ„Ø©" : "ğŸ”“ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ØªØ­Ø±ÙƒØ©";
        btn.style.background = isLocked ? "#b38b2d" : "#222";
        document.getElementById('logoContainer').classList.toggle('locked');
        document.getElementById('signContainer').classList.toggle('locked');
    }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ---
    function getInvNum() {
        let n = localStorage.getItem('inv_n') || 1001;
        localStorage.setItem('inv_n', parseInt(n) + 1);
        return n;
    }

    function loadTemplate() {
        const type = document.getElementById('templateSelector').value;
        if (type === 'invoice') {
            editor.innerHTML = `<div style="display:flex; justify-content:space-between; font-size:12px"><span>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: #INV-${getInvNum()}</span><span>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('he-IL')}</span></div>
                <div class="doc-title">ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ© / ×—×©×‘×•× ×™×ª ××¡</div>
                <p>Ø§Ù„Ø¹Ù…ÙŠÙ„: [Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„]</p>
                <table id="invTable">
                    <thead><tr><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                    <tbody><tr><td>Ù…Ù†ØªØ¬</td><td>1</td><td>0</td><td>0</td></tr></tbody>
                </table>
                <button class="add-row-btn" onclick="addRow()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
                <h3 style="text-align:left">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="gTotal">0</span> â‚ª</h3>`;
        } else if (type === 'delivery') {
            editor.innerHTML = `<div class="doc-title">Ø¥Ø±Ø³Ø§Ù„ÙŠØ© / ×ª×¢×•×“×ª ××©×œ×•×—</div>
                <p>Ø¥Ù„Ù‰: ....................</p>
                <table><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead>
                <tbody><tr><td>-</td><td>-</td><td>-</td></tr></tbody></table>
                <button class="add-row-btn" onclick="addRow()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>`;
        } else if (type === 'blank') {
            editor.innerHTML = `<div class="doc-title">Ù…Ø³ØªÙ†Ø¯ Ø±Ø³Ù…ÙŠ</div><p>Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...</p>`;
        } else {
            editor.innerHTML = `<div class="doc-title">Ø¹Ù‚Ø¯ Ø¹Ù…Ù„ Ø±Ø³Ù…ÙŠ</div><p>ØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¨ÙŠÙ† Ø´Ø±ÙƒØ© <strong>MAD PARFUMEUR</strong> ÙˆØ§Ù„Ø³ÙŠØ¯/Ø© [Ø§Ù„Ø§Ø³Ù…]...</p>`;
        }
        saveAll();
    }

    function addRow() {
        const table = document.querySelector('table tbody');
        const row = table.insertRow();
        row.innerHTML = table.rows[0].cells.length === 4 ? `<td>-</td><td>0</td><td>0</td><td>0</td>` : `<td>-</td><td>0</td><td>-</td>`;
        Array.from(row.cells).forEach(c => c.contentEditable = true);
    }

    document.addEventListener('input', () => {
        const rows = document.querySelectorAll('#invTable tbody tr');
        let grand = 0;
        rows.forEach(r => {
            let q = parseFloat(r.cells[1].innerText) || 0, p = parseFloat(r.cells[2].innerText) || 0;
            let t = q * p; r.cells[3].innerText = t.toFixed(2); grand += t;
        });
        if (document.getElementById('gTotal')) document.getElementById('gTotal').innerText = grand.toFixed(2);
        saveAll();
    });

    function toggleDir() {
        const p = document.getElementById('paper');
        p.dir = p.dir === 'rtl' ? 'ltr' : 'rtl';
        p.style.textAlign = p.dir === 'rtl' ? 'right' : 'left';
        saveAll();
    }

    function insertDate() { document.execCommand('insertText', false, new Date().toLocaleDateString('he-IL')); }

    function resetAll() { if(confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) { localStorage.clear(); location.reload(); } }

    window.onload = loadSaved;
</script>
</body>
</html>
