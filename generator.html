<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD PARFUMEUR | Professional Admin System Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --royal-black: #0a0a0a;
            --deep-gold: #b38b2d;
            --bg-canvas: #111111;
        }

        body { margin: 0; font-family: 'Assistant', sans-serif; background: var(--bg-canvas); color: #333; }

        /* --- Toolbar --- */
        .toolbar {
            position: sticky; top: 0; width: 100%; background: #000; padding: 12px;
            display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;
            z-index: 99999; border-bottom: 2px solid var(--deep-gold);
        }
        .toolbar button, .toolbar select {
            background: #222; color: #fff; border: 1px solid var(--deep-gold);
            padding: 8px 15px; cursor: pointer; border-radius: 4px; font-weight: bold;
        }
        .toolbar button:hover { background: var(--deep-gold); color: black; }
        .btn-print { background: var(--deep-gold) !important; color: black !important; }

        /* --- Paper Style --- */
        .page-container { display: flex; justify-content: center; padding: 40px 0; position: relative; }
        .paper {
            width: 210mm; min-height: 297mm; background: white; position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,1); display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- Graphic Frames --- */
        .top-frame { height: 160px; background: var(--royal-black); clip-path: polygon(0 0, 100% 0, 100% 60%, 0% 100%); position: relative; z-index: 10; }
        .top-frame::after { content: ""; position: absolute; bottom: 0; right: 0; width: 100%; height: 12px; background: var(--deep-gold); transform: translateY(5px) rotate(-2deg); }
        
        .bottom-frame { height: 100px; background: var(--royal-black); clip-path: polygon(0 40%, 100% 0, 100% 100%, 0% 100%); margin-top: auto; position: relative; z-index: 10; }

        /* --- Moveable Elements (HIGHEST PRIORITY) --- */
        .movable { 
            position: absolute !important; 
            cursor: move !important; 
            z-index: 9999 !important; 
            border: 2px dashed transparent;
            display: inline-block;
        }
        .movable:hover { border: 2px dashed var(--deep-gold); }
        .movable img { width: 100%; height: auto; display: block; pointer-events: none; }
        
        .resizer { 
            width: 18px; height: 18px; background: var(--deep-gold); 
            position: absolute; right: -9px; bottom: -9px; 
            cursor: nwse-resize; border-radius: 50%; display: none; 
            z-index: 100000; border: 2px solid white;
        }
        .movable:hover .resizer { display: block; }
        .locked { border: none !important; cursor: default !important; }
        .locked .resizer { display: none !important; }

        /* --- Content Areas --- */
        .main-content { padding: 40px 60px; flex-grow: 1; outline: none; font-family: 'Amiri', serif; font-size: 13pt; line-height: 1.8; z-index: 20; position: relative; color: #111; }
        .doc-title { text-align: center; font-size: 28pt; font-weight: bold; color: var(--royal-black); margin-bottom: 20px; text-decoration: underline; }

        /* --- Tables --- */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: transparent; }
        th { background: var(--royal-black); color: white; padding: 12px; border: 1px solid #333; }
        td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .add-row-btn { background: #f9f9f9; border: 1px dashed #aaa; width: 100%; padding: 10px; cursor: pointer; margin-top: 5px; font-weight: bold; color: #555; }

        /* --- Print Optimization --- */
        @media print {
            body { background: white; } 
            .toolbar, .add-row-btn { display: none !important; }
            .page-container { padding: 0; } 
            .paper { box-shadow: none; width: 100%; margin: 0; }
            .movable { border: none !important; }
            .top-frame, .bottom-frame { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>

<div class="toolbar">
    <select id="templateSelector" onchange="loadTemplate()">
        <option value="contract">ğŸ“„ Ø¹Ù‚Ø¯ Ø¹Ù…Ù„</option>
        <option value="invoice">ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©</option>
        <option value="delivery">ğŸšš Ø¥Ø±Ø³Ø§Ù„ÙŠØ© Ø¨Ø¶Ø§Ø¹Ø©</option>
        <option value="blank">âšª ØµÙØ­Ø© ÙØ§Ø±ØºØ©</option>
    </select>
    
    <button onclick="toggleDir()">ğŸ”„ Ø§ØªØ¬Ø§Ù‡ (AR/HE)</button>
    <button onclick="insertDate()">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</button>
    <button onclick="toggleLock()" id="lockBtn">ğŸ”“ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ØªØ­Ø±ÙƒØ©</button>
    <button onclick="document.execCommand('bold')">B</button>
    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ØªØµØ¯ÙŠØ± PDF</button>
    <button style="background:#800" onclick="resetAll()">ğŸ§¹ Ù…Ø³Ø­ Ø´Ø§Ù…Ù„</button>
</div>

<div class="page-container">
    <div class="paper" id="paper" dir="rtl">
        <div class="top-frame"></div>

        <div class="movable" id="logoContainer" style="top: 25px; left: 50px; width: 180px;">
            <img src="logo.jpg" alt="Logo">
            <div class="resizer"></div>
        </div>

        <div class="main-content" id="editorArea" contenteditable="true">
            </div>

        <div class="movable" id="signContainer" style="bottom: 120px; right: 50px; width: 150px;">
            <img src="signther.jpg" alt="Signature">
            <div class="resizer"></div>
        </div>

        <div class="bottom-frame"></div>
    </div>
</div>

<script>
    let isLocked = false;
    const editor = document.getElementById('editorArea');

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø·ÙˆØ± (Drag & Resize) ---
    function initMovable(el) {
        let isDragging = false, isResizing = false, sx, sy, sw, sh;

        el.onmousedown = (e) => {
            if (isLocked) return;
            if (e.target.className === 'resizer') {
                isResizing = true;
            } else {
                isDragging = true;
            }
            sx = e.clientX; sy = e.clientY;
            sw = el.offsetWidth; sh = el.offsetHeight;
            e.stopPropagation();
        };

        document.onmousemove = (e) => {
            if (isDragging) {
                el.style.left = (el.offsetLeft + (e.clientX - sx)) + "px";
                el.style.top = (el.offsetTop + (e.clientY - sy)) + "px";
                sx = e.clientX; sy = e.clientY;
            } else if (isResizing) {
                el.style.width = (sw + (e.clientX - sx)) + "px";
            }
        };

        document.onmouseup = () => { 
            isDragging = false; 
            isResizing = false;
            saveAllData(); 
        };
    }

    initMovable(document.getElementById('logoContainer'));
    initMovable(document.getElementById('signContainer'));

    function toggleLock() {
        isLocked = !isLocked;
        const btn = document.getElementById('lockBtn');
        btn.innerText = isLocked ? "ğŸ”’ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù‚ÙÙ„Ø©" : "ğŸ”“ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ØªØ­Ø±ÙƒØ©";
        btn.style.background = isLocked ? "#b38b2d" : "#222";
        document.getElementById('logoContainer').classList.toggle('locked', isLocked);
        document.getElementById('signContainer').classList.toggle('locked', isLocked);
    }

    // --- Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø°ÙƒÙŠØ© ---
    function loadTemplate() {
        const type = document.getElementById('templateSelector').value;
        const dateNow = new Date().toLocaleDateString('he-IL');
        
        if (type === 'invoice') {
            const invNum = localStorage.getItem('mad_inv_counter') || 5000;
            editor.innerHTML = `
                <div style="display:flex; justify-content:space-between; font-size:12px; border-bottom:1px solid #eee; padding-bottom:5px;">
                    <span>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: #INV-${invNum}</span>
                    <span>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateNow}</span>
                </div>
                <div class="doc-title">ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ© / ×—×©×‘×•× ×™×ª ××¡</div>
                <p>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ / ×œ×›×‘×•×“: <span contenteditable="true">.........................</span></p>
                <table id="invTable">
                    <thead><tr><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                    <tbody><tr><td contenteditable="true">Ø¹Ø·Ø± MAD</td><td contenteditable="true">1</td><td contenteditable="true">0</td><td>0.00</td></tr></tbody>
                </table>
                <button class="add-row-btn" onclick="addRow()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ù„Ù„ÙØ§ØªÙˆØ±Ø©</button>
                <h3 style="text-align:left; margin-top:20px;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="gTotal">0.00</span> â‚ª</h3>`;
            localStorage.setItem('mad_inv_counter', parseInt(invNum) + 1);
        } else if (type === 'delivery') {
            editor.innerHTML = `<div class="doc-title">Ø¥Ø±Ø³Ø§Ù„ÙŠØ© / ×ª×¢×•×“×ª ××©×œ×•×—</div><p>Ø¥Ù„Ù‰: [Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…]</p><table><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead><tbody><tr><td contenteditable="true">-</td><td contenteditable="true">0</td><td contenteditable="true">-</td></tr></tbody></table><button class="add-row-btn" onclick="addRow()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>`;
        } else if (type === 'blank') {
            editor.innerHTML = `<div class="doc-title">Ù…Ø³ØªÙ†Ø¯ Ø¥Ø¯Ø§Ø±ÙŠ</div><p>Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...</p>`;
        } else {
            editor.innerHTML = `<div class="doc-title">Ø¹Ù‚Ø¯ Ø¹Ù…Ù„ Ù…ÙˆØ¸Ù</div><p>Ø¥Ù†Ù‡ ÙÙŠ ÙŠÙˆÙ… ${dateNow} ØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¨ÙŠÙ† Ø´Ø±ÙƒØ© <strong>MAD PARFUMEUR</strong> ÙˆØ¨ÙŠÙ† Ø§Ù„Ø³ÙŠØ¯/Ø© [Ø§Ù„Ø§Ø³Ù…]...</p>`;
        }
        saveAllData();
    }

    function addRow() {
        const table = document.querySelector('table tbody');
        const row = table.insertRow();
        const colCount = table.rows[0].cells.length;
        if(colCount === 4) row.innerHTML = `<td contenteditable="true">-</td><td contenteditable="true">1</td><td contenteditable="true">0</td><td>0.00</td>`;
        else row.innerHTML = `<td contenteditable="true">-</td><td contenteditable="true">0</td><td contenteditable="true">-</td>`;
    }

    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    document.addEventListener('input', () => {
        const invTable = document.getElementById('invTable');
        if (invTable) {
            let totalSum = 0;
            invTable.querySelectorAll('tbody tr').forEach(r => {
                let q = parseFloat(r.cells[1].innerText) || 0;
                let p = parseFloat(r.cells[2].innerText) || 0;
                let t = q * p;
                r.cells[3].innerText = t.toFixed(2);
                totalSum += t;
            });
            document.getElementById('gTotal').innerText = totalSum.toFixed(2);
        }
        saveAllData();
    });

    // --- Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­ ---
    function saveAllData() {
        const state = {
            html: editor.innerHTML,
            logo: { t: logoContainer.style.top, l: logoContainer.style.left, w: logoContainer.style.width },
            sign: { b: signContainer.style.bottom, r: signContainer.style.right, w: signContainer.style.width },
            dir: paper.dir
        };
        localStorage.setItem('mad_perfume_pro_vFinal', JSON.stringify(state));
    }

    window.onload = () => {
        const saved = JSON.parse(localStorage.getItem('mad_perfume_pro_vFinal'));
        if (saved) {
            editor.innerHTML = saved.html;
            logoContainer.style.top = saved.logo.t;
            logoContainer.style.left = saved.logo.l;
            logoContainer.style.width = saved.logo.width;
            signContainer.style.bottom = saved.sign.b;
            signContainer.style.right = saved.sign.r;
            signContainer.style.width = saved.sign.w;
            paper.dir = saved.dir;
        } else {
            loadTemplate();
        }
    };

    function toggleDir() {
        paper.dir = paper.dir === 'rtl' ? 'ltr' : 'rtl';
        paper.style.textAlign = paper.dir === 'rtl' ? 'right' : 'left';
        saveAllData();
    }

    function insertDate() { document.execCommand('insertText', false, new Date().toLocaleDateString('he-IL')); }
    function resetAll() { if(confirm("ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ!")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
